<!--
  IncidentResponseDemo.vue
  æ•…éšœå“åº”æµç¨‹æ¼”ç¤ºï¼šå±•ç¤ºä»æ•…éšœå‘ç°åˆ°å¤ç›˜çš„å®Œæ•´æµç¨‹
-->
<template>
  <div class="incident-demo">
    <div class="header">
      <div class="title">æ•…éšœå“åº”æµç¨‹ (Incident Response)</div>
      <div class="subtitle">ä¸“ä¸šå›¢é˜Ÿå¦‚ä½•å¤„ç†çº¿ä¸Šæ•…éšœ</div>
    </div>

    <div class="timeline">
      <div
        v-for="(phase, index) in phases"
        :key="phase.id"
        :class="[
          'phase',
          { active: activePhase === index, completed: activePhase > index }
        ]"
        @click="activePhase = index"
      >
        <div class="phase-marker">{{ index + 1 }}</div>
        <div class="phase-content">
          <div class="phase-title">{{ phase.title }}</div>
          <div class="phase-time">{{ phase.time }}</div>
          <div class="phase-desc">{{ phase.desc }}</div>
          <div v-if="activePhase === index" class="phase-actions">
            <div class="action-title">å…³é”®åŠ¨ä½œï¼š</div>
            <ul class="action-list">
              <li v-for="action in phase.actions" :key="action">
                {{ action }}
              </li>
            </ul>
            <div v-if="phase.tools" class="tools-section">
              <div class="tools-title">å¸¸ç”¨å·¥å…·ï¼š</div>
              <div class="tools-list">
                <span
                  v-for="tool in phase.tools"
                  :key="tool"
                  class="tool-tag"
                  >{{ tool }}</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="incident-meta" v-if="activePhase === phases.length - 1">
      <div class="meta-title">ğŸ“‹ æ•…éšœå¤ç›˜æŠ¥å‘Š (Post-mortem)</div>
      <div class="meta-content">
        <div class="meta-section">
          <div class="meta-label">æ•…éšœç­‰çº§ï¼š</div>
          <div class="meta-value level-p1">P1 - é«˜ä¼˜å…ˆçº§</div>
        </div>
        <div class="meta-section">
          <div class="meta-label">å½±å“èŒƒå›´ï¼š</div>
          <div class="meta-value">çº¦ 15% ç”¨æˆ·æ— æ³•è®¿é—®è®¢å•æœåŠ¡</div>
        </div>
        <div class="meta-section">
          <div class="meta-label">æ•…éšœæ—¶é•¿ï¼š</div>
          <div class="meta-value">23 åˆ†é’Ÿ</div>
        </div>
        <div class="meta-section">
          <div class="meta-label">æ ¹æœ¬åŸå› ï¼š</div>
          <div class="meta-value">æ•°æ®åº“è¿æ¥æ± é…ç½®è¿‡å°ï¼Œé«˜å³°æœŸè¿æ¥è€—å°½</div>
        </div>
        <div class="meta-section">
          <div class="meta-label">æ”¹è¿›æªæ–½ï¼š</div>
          <div class="meta-value">
            1. å¢åŠ è¿æ¥æ± å¤§å°è‡³ 200
            <br />
            2. æ·»åŠ è¿æ¥æ± ç›‘æ§å‘Šè­¦
            <br />
            3. ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼Œå‡å°‘è¿æ¥å ç”¨æ—¶é—´
          </div>
        </div>
      </div>
    </div>

    <div class="best-practices">
      <div class="practice-title">ğŸ¯ æ•…éšœå¤„ç†æœ€ä½³å®è·µ</div>
      <div class="practice-grid">
        <div class="practice-card">
          <div class="practice-icon">âš¡</div>
          <div class="practice-name">å¿«é€Ÿå“åº”</div>
          <div class="practice-desc">
            å»ºç«‹ 15 åˆ†é’Ÿå“åº”æœºåˆ¶ï¼ŒP0 æ•…éšœç«‹å³ç”µè¯é€šçŸ¥
          </div>
        </div>
        <div class="practice-card">
          <div class="practice-icon">ğŸ“¢</div>
          <div class="practice-name">ä¿¡æ¯åŒæ­¥</div>
          <div class="practice-desc">
            å®šæœŸå‘ç”¨æˆ·å’Œå†…éƒ¨åŒæ­¥æ•…éšœè¿›å±•ï¼Œé¿å…çŒœæµ‹
          </div>
        </div>
        <div class="practice-card">
          <div class="practice-icon">ğŸ”</div>
          <div class="practice-name">ä¿ç•™ç°åœº</div>
          <div class="practice-desc">
            æ•…éšœç°åœºæ•°æ®ï¼ˆæ—¥å¿—ã€ç›‘æ§ï¼‰å®Œæ•´ç•™å­˜ï¼Œä¾¿äºåˆ†æ
          </div>
        </div>
        <div class="practice-card">
          <div class="practice-icon">ğŸ“</div>
          <div class="practice-name">blameless æ–‡åŒ–</div>
          <div class="practice-desc">
            å¤ç›˜å¯¹äº‹ä¸å¯¹äººï¼Œèšç„¦æµç¨‹æ”¹è¿›è€Œéä¸ªäººè´£ä»»
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const activePhase = ref(0)

const phases = [
  {
    id: 'detect',
    title: 'æ•…éšœå‘ç°',
    time: 'T+0 åˆ†é’Ÿ',
    desc: 'ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨å‘ç°å¼‚å¸¸æŒ‡æ ‡',
    actions: [
      'ç›‘æ§æ£€æµ‹åˆ°è®¢å•æœåŠ¡é”™è¯¯ç‡ä» 0.1% é£™å‡åˆ° 8.5%',
      'Alertmanager ç«‹å³è§¦å‘ P1 å‘Šè­¦',
      'å€¼ç­äººå‘˜æ”¶åˆ°é’‰é’‰å’ŒçŸ­ä¿¡é€šçŸ¥'
    ],
    tools: ['Prometheus', 'Grafana', 'Alertmanager']
  },
  {
    id: 'respond',
    title: 'å¿«é€Ÿå“åº”',
    time: 'T+3 åˆ†é’Ÿ',
    desc: 'å€¼ç­äººå‘˜ç¡®è®¤æ•…éšœå¹¶å¯åŠ¨åº”æ€¥æµç¨‹',
    actions: [
      'ç™»å½•ç›‘æ§é¢æ¿ç¡®è®¤æ•…éšœèŒƒå›´',
      'åˆ›å»ºçº¿ä¸Šæ•…éšœ War Room ä¼šè®®',
      'é€šçŸ¥ç›¸å…³å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜'
    ],
    tools: ['é’‰é’‰/é£ä¹¦', 'Zoom/è…¾è®¯ä¼šè®®']
  },
  {
    id: 'diagnose',
    title: 'æ•…éšœå®šä½',
    time: 'T+8 åˆ†é’Ÿ',
    desc: 'é€šè¿‡æ—¥å¿—å’Œè¿½è¸ªç³»ç»Ÿåˆ†ææ ¹å› ',
    actions: [
      'æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œå‘ç°å¤§é‡ "Connection pool exhausted" é”™è¯¯',
      'é€šè¿‡é“¾è·¯è¿½è¸ªå®šä½åˆ°æ•°æ®åº“æŸ¥è¯¢è€—æ—¶å¼‚å¸¸',
      'æ£€æŸ¥æ•°æ®åº“ç›‘æ§ï¼Œå‘ç°è¿æ¥æ± å·²æ»¡'
    ],
    tools: ['ELK', 'Jaeger/Zipkin', 'Arthas', 'tcpdump']
  },
  {
    id: 'fix',
    title: 'æ•…éšœä¿®å¤',
    time: 'T+18 åˆ†é’Ÿ',
    desc: 'å®æ–½ä¸´æ—¶è§£å†³æ–¹æ¡ˆæ¢å¤æœåŠ¡',
    actions: [
      'ç´§æ€¥æ‰©å®¹æ•°æ®åº“è¿æ¥æ± ä» 50 åˆ° 200',
      'é‡å¯åº”ç”¨æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ',
      'ç›‘æ§æ˜¾ç¤ºé”™è¯¯ç‡é€æ¸ä¸‹é™åˆ°æ­£å¸¸æ°´å¹³'
    ],
    tools: ['K8s Dashboard', 'kubectl', 'ansible']
  },
  {
    id: 'verify',
    title: 'æ¢å¤éªŒè¯',
    time: 'T+21 åˆ†é’Ÿ',
    desc: 'ç¡®è®¤æœåŠ¡å®Œå…¨æ¢å¤æ­£å¸¸',
    actions: [
      'ç›‘æ§æŒ‡æ ‡å…¨éƒ¨å›åˆ°æ­£å¸¸èŒƒå›´',
      'æ‰§è¡Œå†’çƒŸæµ‹è¯•éªŒè¯æ ¸å¿ƒåŠŸèƒ½',
      'è§‚å¯Ÿ 5 åˆ†é’Ÿæ— å¼‚å¸¸ï¼Œå®£å¸ƒæ•…éšœç»“æŸ'
    ],
    tools: ['Postman', 'è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°']
  },
  {
    id: 'postmortem',
    title: 'æ•…éšœå¤ç›˜',
    time: 'T+48 å°æ—¶',
    desc: 'æ€»ç»“ç»éªŒæ•™è®­ï¼Œåˆ¶å®šæ”¹è¿›è®¡åˆ’',
    actions: [
      'å¬å¼€å¤ç›˜ä¼šè®®ï¼Œæ•´ç†æ•…éšœæ—¶é—´çº¿',
      'ç¼–å†™ Post-mortem æŠ¥å‘Š',
      'è·Ÿè¿›æ”¹è¿›æªæ–½è½å®æƒ…å†µ'
    ],
    tools: ['Confluence/Notion', 'JIRA']
  }
]
</script>

<style scoped>
.incident-demo {
  border: 1px solid var(--vp-c-divider);
  background: var(--vp-c-bg-soft);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  font-family: var(--vp-font-family-base);
}

.header {
  margin-bottom: 1.5rem;
}

.title {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 0.25rem;
}

.subtitle {
  color: var(--vp-c-text-2);
  font-size: 0.9rem;
}

.timeline {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.phase {
  display: flex;
  gap: 1rem;
  padding: 0.75rem;
  background: var(--vp-c-bg);
  border-radius: 10px;
  border: 2px solid var(--vp-c-divider);
  cursor: pointer;
  transition: all 0.3s;
}

.phase:hover {
  border-color: var(--vp-c-brand);
}

.phase.active {
  border-color: var(--vp-c-brand);
  background: rgba(var(--vp-c-brand-rgb), 0.05);
}

.phase.completed {
  border-color: #22c55e;
  background: rgba(34, 197, 94, 0.02);
}

.phase-marker {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--vp-c-bg-soft);
  border: 2px solid var(--vp-c-divider);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1rem;
  flex-shrink: 0;
}

.phase.active .phase-marker {
  border-color: var(--vp-c-brand);
  color: var(--vp-c-brand);
  background: rgba(var(--vp-c-brand-rgb), 0.1);
}

.phase.completed .phase-marker {
  border-color: #22c55e;
  color: #22c55e;
  background: rgba(34, 197, 94, 0.1);
}

.phase-content {
  flex: 1;
}

.phase-title {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 0.25rem;
}

.phase-time {
  font-size: 0.85rem;
  color: var(--vp-c-brand);
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.phase-desc {
  font-size: 0.9rem;
  color: var(--vp-c-text-2);
  margin-bottom: 0.75rem;
}

.phase-actions {
  padding: 0.75rem;
  background: var(--vp-c-bg-soft);
  border-radius: 6px;
  margin-top: 0.75rem;
}

.action-title {
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 0.5rem;
}

.action-list {
  margin: 0;
  padding-left: 1.25rem;
  font-size: 0.85rem;
  color: var(--vp-c-text-2);
}

.action-list li {
  margin-bottom: 0.25rem;
}

.tools-section {
  margin-top: 0.75rem;
}

.tools-title {
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 0.5rem;
}

.tools-list {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.tool-tag {
  padding: 0.25rem 0.5rem;
  background: var(--vp-c-bg);
  border: 1px solid var(--vp-c-divider);
  border-radius: 4px;
  font-size: 0.75rem;
  font-family: var(--vp-font-family-mono);
}

.incident-meta {
  background: var(--vp-c-bg);
  border-radius: 10px;
  padding: 0.75rem;
  margin-bottom: 1.5rem;
  border: 1px solid var(--vp-c-divider);
}

.meta-title {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 1rem;
}

.meta-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.meta-section {
  display: flex;
  gap: 1rem;
  font-size: 0.9rem;
}

.meta-label {
  min-width: 100px;
  font-weight: 600;
  color: var(--vp-c-text-1);
}

.meta-value {
  flex: 1;
  color: var(--vp-c-text-2);
  line-height: 1.6;
}

.meta-value.level-p1 {
  color: #f59e0b;
  font-weight: 700;
}

.best-practices {
  background: rgba(var(--vp-c-brand-rgb), 0.05);
  border-radius: 10px;
  padding: 0.75rem;
  border: 1px solid var(--vp-c-brand);
}

.practice-title {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 1rem;
}

.practice-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.practice-card {
  background: var(--vp-c-bg);
  border-radius: 6px;
  padding: 0.75rem;
  text-align: center;
}

.practice-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.practice-name {
  font-weight: 700;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.practice-desc {
  font-size: 0.8rem;
  color: var(--vp-c-text-2);
  line-height: 1.5;
}

@media (max-width: 768px) {
  .phase {
    flex-direction: column;
  }

  .phase-marker {
    width: 32px;
    height: 32px;
  }

  .meta-section {
    flex-direction: column;
    gap: 0.25rem;
  }

  .meta-label {
    min-width: auto;
  }

  .practice-grid {
    grid-template-columns: 1fr;
  }
}
</style>
