#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Pre-commit checks started..."
echo ""

# 1. ESLint æ£€æŸ¥ï¼ˆåªæ£€æŸ¥ errorsï¼Œå¿½ç•¥ warningsï¼‰
echo "1ï¸âƒ£ Running ESLint check..."
LINT_OUTPUT=$(npm run lint 2>&1)
LINT_EXIT_CODE=$?

# æ£€æŸ¥æ˜¯å¦æœ‰çœŸæ­£çš„ errorsï¼ˆä¸åŒ…æ‹¬ warningsï¼‰
if echo "$LINT_OUTPUT" | grep -q "âœ–.*[1-9] error"; then
  echo ""
  echo "âŒ ESLint errors found! Please fix before committing."
  echo ""
  echo "$LINT_OUTPUT"
  exit 1
fi
echo "âœ… ESLint: No errors (warnings ignored)"
echo ""

# 2. Build æ£€æŸ¥ï¼ˆç¡®ä¿ä»£ç èƒ½æˆåŠŸæ„å»ºï¼‰
echo "2ï¸âƒ£ Running build check..."
if ! npm run build > /dev/null 2>&1; then
  echo ""
  echo "âŒ Build failed! Please fix build errors before committing."
  echo ""
  echo "ğŸ’¡ Run 'npm run build' to see detailed errors"
  echo "ğŸ’¡ To skip pre-commit checks: git commit --no-verify"
  exit 1
fi
echo "âœ… Build: Success"
echo ""

echo "âœ… All pre-commit checks passed!"
echo "ğŸ“¦ Build output verified, committing..."
